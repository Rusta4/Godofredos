"use strict";var li=Object.create;var Dt=Object.defineProperty;var ui=Object.getOwnPropertyDescriptor;var di=Object.getOwnPropertyNames;var pi=Object.getPrototypeOf,mi=Object.prototype.hasOwnProperty;var Vr=r=>{throw TypeError(r)};var He=(r,e)=>()=>(r&&(e=r(r=0)),e);var Ee=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ue=(r,e)=>{for(var t in e)Dt(r,t,{get:e[t],enumerable:!0})},Qr=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of di(e))!mi.call(r,s)&&s!==t&&Dt(r,s,{get:()=>e[s],enumerable:!(n=ui(e,s))||n.enumerable});return r};var _=(r,e,t)=>(t=r!=null?li(pi(r)):{},Qr(e||!r||!r.__esModule?Dt(t,"default",{value:r,enumerable:!0}):t,r)),fi=r=>Qr(Dt({},"__esModule",{value:!0}),r);var Xt=(r,e,t)=>e.has(r)||Vr("Cannot "+t);var o=(r,e,t)=>(Xt(r,e,"read from private field"),t?t.call(r):e.get(r)),h=(r,e,t)=>e.has(r)?Vr("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),y=(r,e,t,n)=>(Xt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),u=(r,e,t)=>(Xt(r,e,"access private method"),t);var de=(r,e,t,n)=>({set _(s){y(r,e,s,t)},get _(){return o(r,e,n)}});var yi,S,f=He(()=>{"use strict";yi=()=>typeof document>"u"?new URL(`file:${__filename}`).href:document.currentScript&&document.currentScript.src||new URL("main.js",document.baseURI).href,S=yi()});var qe=Ee((za,U)=>{"use strict";f();var Kr=9007199254740991,Xr=function(r){return r}();function wi(r){return r===Xr}function Jr(r){return typeof r=="string"||Object.prototype.toString.call(r)=="[object String]"}function Si(r){return Object.prototype.toString.call(r)=="[object Date]"}function vt(r){return r!==null&&typeof r=="object"}function Mt(r){return typeof r=="function"}function xi(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Kr}function Pi(r){return Object.prototype.toString.call(r)=="[object Array]"}function Zr(r){return vt(r)&&!Mt(r)&&xi(r.length)}function Zt(r){return Object.prototype.toString.call(r)=="[object ArrayBuffer]"}function Ai(r,e){return Array.prototype.map.call(r,e)}function Ti(r,e){var t=Xr;return Mt(e)&&Array.prototype.every.call(r,function(n,s,i){var a=e(n,s,i);return a&&(t=n),!a}),t}function Ei(r){return Object.assign.apply(null,arguments)}function en(r){var e,t,n;if(Jr(r)){for(t=r.length,n=new Uint8Array(t),e=0;e<t;e++)n[e]=r.charCodeAt(e)&255;return n}return Zt(r)?new Uint8Array(r):vt(r)&&Zt(r.buffer)?new Uint8Array(r.buffer):Zr(r)?new Uint8Array(r):vt(r)&&Mt(r.toString)?en(r.toString()):new Uint8Array}U.exports.MAX_SAFE_INTEGER=Kr;U.exports.isUndefined=wi;U.exports.isString=Jr;U.exports.isObject=vt;U.exports.isDateTime=Si;U.exports.isFunction=Mt;U.exports.isArray=Pi;U.exports.isArrayLike=Zr;U.exports.isArrayBuffer=Zt;U.exports.map=Ai;U.exports.find=Ti;U.exports.extend=Ei;U.exports.toUint8Array=en});var We=Ee((ja,tn)=>{"use strict";f();var er="\0";tn.exports={NULL_CHAR:er,TMAGIC:"ustar"+er+"00",OLDGNU_MAGIC:"ustar  "+er,REGTYPE:0,LNKTYPE:1,SYMTYPE:2,CHRTYPE:3,BLKTYPE:4,DIRTYPE:5,FIFOTYPE:6,CONTTYPE:7,TSUID:parseInt("4000",8),TSGID:parseInt("2000",8),TSVTX:parseInt("1000",8),TUREAD:parseInt("0400",8),TUWRITE:parseInt("0200",8),TUEXEC:parseInt("0100",8),TGREAD:parseInt("0040",8),TGWRITE:parseInt("0020",8),TGEXEC:parseInt("0010",8),TOREAD:parseInt("0004",8),TOWRITE:parseInt("0002",8),TOEXEC:parseInt("0001",8),TPERMALL:parseInt("0777",8),TPERMMASK:parseInt("0777",8)}});var nr=Ee((qa,C)=>{"use strict";f();var rn=qe(),F=We(),Fi=512,tr=F.TPERMALL,nn=0,sn=0,rr=[["name",100,0,function(r,e){return Ve(r[e[0]],e[1])},function(r,e,t){return pe(r.slice(e,e+t[1]))}],["mode",8,100,function(r,e){var t=r[e[0]]||tr;return t=t&F.TPERMMASK,Fe(t,e[1],tr)},function(r,e,t){var n=Y(r.slice(e,e+t[1]));return n&=F.TPERMMASK,n}],["uid",8,108,function(r,e){return Fe(r[e[0]],e[1],nn)},function(r,e,t){return Y(r.slice(e,e+t[1]))}],["gid",8,116,function(r,e){return Fe(r[e[0]],e[1],sn)},function(r,e,t){return Y(r.slice(e,e+t[1]))}],["size",12,124,function(r,e){return Fe(r.data.length,e[1])},function(r,e,t){return Y(r.slice(e,e+t[1]))}],["modifyTime",12,136,function(r,e){return It(r[e[0]],e[1])},function(r,e,t){return Ot(r.slice(e,e+t[1]))}],["checksum",8,148,function(r,e){return"        "},function(r,e,t){return Y(r.slice(e,e+t[1]))}],["type",1,156,function(r,e){return""+(parseInt(r[e[0]],10)||0)%8},function(r,e,t){return(parseInt(String.fromCharCode(r[e]),10)||0)%8}],["linkName",100,157,function(r,e){return""},function(r,e,t){return pe(r.slice(e,e+t[1]))}],["ustar",8,257,function(r,e){return F.TMAGIC},function(r,e,t){return Di(pe(r.slice(e,e+t[1]),!0))},function(r,e){return r[e[0]]==F.TMAGIC||r[e[0]]==F.OLDGNU_MAGIC}],["owner",32,265,function(r,e){return Ve(r[e[0]],e[1])},function(r,e,t){return pe(r.slice(e,e+t[1]))}],["group",32,297,function(r,e){return Ve(r[e[0]],e[1])},function(r,e,t){return pe(r.slice(e,e+t[1]))}],["majorNumber",8,329,function(r,e){return""},function(r,e,t){return Y(r.slice(e,e+t[1]))}],["minorNumber",8,337,function(r,e){return""},function(r,e,t){return Y(r.slice(e,e+t[1]))}],["prefix",131,345,function(r,e){return Ve(r[e[0]],e[1])},function(r,e,t){return pe(r.slice(e,e+t[1]))}],["accessTime",12,476,function(r,e){return It(r[e[0]],e[1])},function(r,e,t){return Ot(r.slice(e,e+t[1]))}],["createTime",12,488,function(r,e){return It(r[e[0]],e[1])},function(r,e,t){return Ot(r.slice(e,e+t[1]))}]],an=function(r){var e=r[r.length-1];return e[2]+e[1]}(rr);function Di(r){if(r.length==8){var e=r.split("");if(e[5]==F.NULL_CHAR)return(e[6]==" "||e[6]==F.NULL_CHAR)&&(e[6]="0"),(e[7]==" "||e[7]==F.NULL_CHAR)&&(e[7]="0"),e=e.join(""),e==F.TMAGIC?e:r;if(e[7]==F.NULL_CHAR)return e[5]==F.NULL_CHAR&&(e[5]=" "),e[6]==F.NULL_CHAR&&(e[6]=" "),e==F.OLDGNU_MAGIC?e:r}return r}function Ve(r,e){return e-=1,rn.isUndefined(r)&&(r=""),r=(""+r).substr(0,e),r+F.NULL_CHAR}function Fe(r,e,t){for(t=parseInt(t)||0,e-=1,r=(parseInt(r)||t).toString(8).substr(-e,e);r.length<e;)r="0"+r;return r+F.NULL_CHAR}function It(r,e){if(rn.isDateTime(r))r=Math.floor(1*r/1e3);else if(r=parseInt(r,10),isFinite(r)){if(r<=0)return""}else r=Math.floor(1*new Date/1e3);return Fe(r,e,0)}function pe(r,e){var t=String.fromCharCode.apply(null,r);if(e)return t;var n=t.indexOf(F.NULL_CHAR);return n>=0?t.substr(0,n):t}function Y(r){var e=String.fromCharCode.apply(null,r);return parseInt(e.replace(/^0+$/g,""),8)||0}function Ot(r){return r.length==0||r[0]==0?null:new Date(1e3*Y(r))}function vi(r,e,t){var n=parseInt(e,10)||0,s=Math.min(n+an,r.length),i=0,a=0,c=0;t&&rr.every(function(m){return m[0]=="checksum"?(a=n+m[2],c=a+m[1],!1):!0});for(var l=32,d=n;d<s;d++){var p=d>=a&&d<c?l:r[d];i=(i+p)%262144}return i}C.exports.recordSize=Fi;C.exports.defaultFileMode=tr;C.exports.defaultUid=nn;C.exports.defaultGid=sn;C.exports.posixHeader=rr;C.exports.effectiveHeaderSize=an;C.exports.calculateChecksum=vi;C.exports.formatTarString=Ve;C.exports.formatTarNumber=Fe;C.exports.formatTarDateTime=It;C.exports.parseTarString=pe;C.exports.parseTarNumber=Y;C.exports.parseTarDateTime=Ot});var un=Ee((Va,ln)=>{"use strict";f();var Mi=We(),Nt=qe(),te=nr();function on(r){return te.recordSize}function cn(r){return Math.ceil(r.data.length/te.recordSize)*te.recordSize}function Ii(r){var e=0;return r.forEach(function(t){e+=on(t)+cn(t)}),e+=te.recordSize*2,new Uint8Array(e)}function Oi(r,e,t){t=parseInt(t)||0;var n=t;te.posixHeader.forEach(function(l){for(var d=l[3](e,l),p=d.length,m=0;m<p;m+=1)r[n+m]=d.charCodeAt(m)&255;n+=l[1]});var s=Nt.find(te.posixHeader,function(l){return l[0]=="checksum"});if(s){var i=te.calculateChecksum(r,t,!0),a=te.formatTarNumber(i,s[1]-2)+Mi.NULL_CHAR+" ";n=t+s[2];for(var c=0;c<a.length;c+=1)r[n]=a.charCodeAt(c)&255,n++}return t+on(e)}function Ni(r,e,t){return t=parseInt(t,10)||0,r.set(e.data,t),t+cn(e)}function Ri(r){r=Nt.map(r,function(n){return Nt.extend({},n,{data:Nt.toUint8Array(n.data)})});var e=Ii(r),t=0;return r.forEach(function(n){t=Oi(e,n,t),t=Ni(e,n,t)}),e}ln.exports.tar=Ri});var pn=Ee(($a,dn)=>{"use strict";f();var _i=We(),sr=qe(),H=nr(),Bi={extractData:!0,checkHeader:!0,checkChecksum:!0,checkFileSize:!0},ki={size:!0,checksum:!0,ustar:!0},ir={unexpectedEndOfFile:"Unexpected end of file.",fileCorrupted:"File is corrupted.",checksumCheckFailed:"Checksum check failed."};function Ui(r){return H.recordSize}function Ci(r){return Math.ceil(r/H.recordSize)*H.recordSize}function Li(r,e){for(var t=e,n=Math.min(r.length,e+H.recordSize*2),s=t;s<n;s++)if(r[s]!=0)return!1;return!0}function zi(r,e,t){if(r.length-e<H.recordSize){if(t.checkFileSize)throw new Error(ir.unexpectedEndOfFile);return null}e=parseInt(e)||0;var n={},s=e;if(H.posixHeader.forEach(function(c){n[c[0]]=c[4](r,s,c),s+=c[1]}),n.type!=0&&(n.size=0),t.checkHeader&&H.posixHeader.forEach(function(c){if(sr.isFunction(c[5])&&!c[5](n,c)){var l=new Error(ir.fileCorrupted);throw l.data={offset:e+c[2],field:c[0]},l}}),t.checkChecksum){var i=H.calculateChecksum(r,e,!0);if(i!=n.checksum){var a=new Error(ir.checksumCheckFailed);throw a.data={offset:e,header:n,checksum:i},a}}return n}function Gi(r,e,t,n){return n.extractData?t.size<=0?new Uint8Array:r.slice(e,e+t.size):null}function ji(r,e){var t={};return H.posixHeader.forEach(function(n){var s=n[0];ki[s]||(t[s]=r[s])}),t.isOldGNUFormat=r.ustar==_i.OLDGNU_MAGIC,e&&(t.data=e),t}function Hi(r,e){e=sr.extend({},Bi,e);for(var t=[],n=0,s=r.length;s-n>=H.recordSize;){r=sr.toUint8Array(r);var i=zi(r,n,e);if(!i)break;n+=Ui(i);var a=Gi(r,n,i,e);if(t.push(ji(i,a)),n+=Ci(i.size),Li(r,n))break}return t}dn.exports.untar=Hi});var ar=Ee((Ka,mn)=>{"use strict";f();var qi=qe(),Wi=We(),Vi=un(),Qi=pn();qi.extend(mn.exports,Vi,Qi,Wi)});async function or(r,e,t="pgdata",n="auto"){let s=Ki(r,e),[i,a]=await Xi(s,n),c=t+(a?".tar.gz":".tar"),l=a?"application/x-gzip":"application/x-tar";return typeof File<"u"?new File([i],c,{type:l}):new Blob([i],{type:l})}async function yn(r,e,t){let n=new Uint8Array(await e.arrayBuffer()),s=typeof File<"u"&&e instanceof File?e.name:void 0;($i.includes(e.type)||s?.endsWith(".tgz")||s?.endsWith(".tar.gz"))&&(n=await es(n));let a=(0,q.untar)(n);for(let c of a){let l=t+c.name,d=l.split("/").slice(0,-1);for(let p=1;p<=d.length;p++){let m=d.slice(0,p).join("/");r.analyzePath(m).exists||r.mkdir(m)}c.type===q.REGTYPE?(r.writeFile(l,c.data),r.utime(l,fn(c.modifyTime),fn(c.modifyTime))):c.type===q.DIRTYPE&&r.mkdir(l)}}function Yi(r,e){let t=[],n=s=>{r.readdir(s).forEach(a=>{if(a==="."||a==="..")return;let c=s+"/"+a,l=r.stat(c),d=r.isFile(l.mode)?r.readFile(c,{encoding:"binary"}):new Uint8Array(0);t.push({name:c.substring(e.length),mode:l.mode,size:l.size,type:r.isFile(l.mode)?q.REGTYPE:q.DIRTYPE,modifyTime:l.mtime,data:d}),r.isDir(l.mode)&&n(c)})};return n(e),t}function Ki(r,e){let t=Yi(r,e);return(0,q.tar)(t)}async function Xi(r,e="auto"){if(e==="none")return[r,!1];if(typeof CompressionStream<"u")return[await Ji(r),!0];if(typeof process<"u"&&process.versions&&process.versions.node)return[await Zi(r),!0];if(e==="auto")return[r,!1];throw new Error("Compression not supported in this environment")}async function Ji(r){let e=new CompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let s=[];for(;;){let{value:c,done:l}=await n.read();if(l)break;c&&s.push(c)}let i=new Uint8Array(s.reduce((c,l)=>c+l.length,0)),a=0;return s.forEach(c=>{i.set(c,a),a+=c.length}),i}async function Zi(r){let{promisify:e}=await import("util"),{gzip:t}=await import("zlib");return await e(t)(r)}async function es(r){if(typeof CompressionStream<"u")return await ts(r);if(typeof process<"u"&&process.versions&&process.versions.node)return await rs(r);throw new Error("Unsupported environment for decompression")}async function ts(r){let e=new DecompressionStream("gzip"),t=e.writable.getWriter(),n=e.readable.getReader();t.write(r),t.close();let s=[];for(;;){let{value:c,done:l}=await n.read();if(l)break;c&&s.push(c)}let i=new Uint8Array(s.reduce((c,l)=>c+l.length,0)),a=0;return s.forEach(c=>{i.set(c,a),a+=c.length}),i}async function rs(r){let{promisify:e}=await import("util"),{gunzip:t}=await import("zlib");return await e(t)(r)}function fn(r){return r?typeof r=="number"?r:Math.floor(r.getTime()/1e3):Math.floor(Date.now()/1e3)}var q,$i,cr=He(()=>{"use strict";f();q=_(ar(),1);$i=["application/x-gtar","application/x-tar+gzip","application/x-gzip","application/gzip"]});var Ye,B,re,Qe,$e,ns,De=He(()=>{"use strict";f();cr();Ye="/tmp/pglite",B=Ye+"/base",re=class{constructor(e){this.dataDir=e}async init(e,t){return this.pg=e,{emscriptenOpts:t}}async syncToFs(e){}async initialSyncFs(){}async closeFs(){}async dumpTar(e,t){return or(this.pg.Module.FS,B,e,t)}},Qe=class{constructor(e,{debug:t=!1}={}){this.dataDir=e,this.debug=t}async syncToFs(e){}async initialSyncFs(){}async closeFs(){}async dumpTar(e,t){return or(this.pg.Module.FS,B,e,t)}async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],s=>{let i=ns(s,this);s.FS.mkdir(B),s.FS.mount(i,{},B)}]}}}},$e={EBADF:8,EBADFD:127,EEXIST:20,EINVAL:28,EISDIR:31,ENODEV:43,ENOENT:44,ENOTDIR:54,ENOTEMPTY:55},ns=(r,e)=>{let t=r.FS,n=e.debug?console.log:null,s={tryFSOperation(i){try{return i()}catch(a){throw a.code?a.code==="UNKNOWN"?new t.ErrnoError($e.EINVAL):new t.ErrnoError(a.code):a}},mount(i){return s.createNode(null,"/",16895,0)},syncfs(i,a,c){},createNode(i,a,c,l){if(!t.isDir(c)&&!t.isFile(c))throw new t.ErrnoError(28);let d=t.createNode(i,a,c);return d.node_ops=s.node_ops,d.stream_ops=s.stream_ops,d},getMode:function(i){return n?.("getMode",i),s.tryFSOperation(()=>e.lstat(i).mode)},realPath:function(i){let a=[];for(;i.parent!==i;)a.push(i.name),i=i.parent;return a.push(i.mount.opts.root),a.reverse(),a.join("/")},node_ops:{getattr(i){n?.("getattr",s.realPath(i));let a=s.realPath(i);return s.tryFSOperation(()=>{let c=e.lstat(a);return{...c,dev:0,ino:i.id,nlink:1,rdev:i.rdev,atime:new Date(c.atime),mtime:new Date(c.mtime),ctime:new Date(c.ctime)}})},setattr(i,a){n?.("setattr",s.realPath(i),a);let c=s.realPath(i);s.tryFSOperation(()=>{a.mode!==void 0&&e.chmod(c,a.mode),a.size!==void 0&&e.truncate(c,a.size),a.timestamp!==void 0&&e.utimes(c,a.timestamp,a.timestamp),a.size!==void 0&&e.truncate(c,a.size)})},lookup(i,a){n?.("lookup",s.realPath(i),a);let c=[s.realPath(i),a].join("/"),l=s.getMode(c);return s.createNode(i,a,l)},mknod(i,a,c,l){n?.("mknod",s.realPath(i),a,c,l);let d=s.createNode(i,a,c,l),p=s.realPath(d);return s.tryFSOperation(()=>(t.isDir(d.mode)?e.mkdir(p,{mode:c}):e.writeFile(p,"",{mode:c}),d))},rename(i,a,c){n?.("rename",s.realPath(i),s.realPath(a),c);let l=s.realPath(i),d=[s.realPath(a),c].join("/");s.tryFSOperation(()=>{e.rename(l,d)}),i.name=c},unlink(i,a){n?.("unlink",s.realPath(i),a);let c=[s.realPath(i),a].join("/");try{e.unlink(c)}catch{}},rmdir(i,a){n?.("rmdir",s.realPath(i),a);let c=[s.realPath(i),a].join("/");return s.tryFSOperation(()=>{e.rmdir(c)})},readdir(i){n?.("readdir",s.realPath(i));let a=s.realPath(i);return s.tryFSOperation(()=>e.readdir(a))},symlink(i,a,c){throw n?.("symlink",s.realPath(i),a,c),new t.ErrnoError(63)},readlink(i){throw n?.("readlink",s.realPath(i)),new t.ErrnoError(63)}},stream_ops:{open(i){n?.("open stream",s.realPath(i.node));let a=s.realPath(i.node);return s.tryFSOperation(()=>{t.isFile(i.node.mode)&&(i.shared.refcount=1,i.nfd=e.open(a))})},close(i){return n?.("close stream",s.realPath(i.node)),s.tryFSOperation(()=>{t.isFile(i.node.mode)&&i.nfd&&--i.shared.refcount===0&&e.close(i.nfd)})},dup(i){n?.("dup stream",s.realPath(i.node)),i.shared.refcount++},read(i,a,c,l,d){return n?.("read stream",s.realPath(i.node),c,l,d),l===0?0:s.tryFSOperation(()=>e.read(i.nfd,a,c,l,d))},write(i,a,c,l,d){return n?.("write stream",s.realPath(i.node),c,l,d),s.tryFSOperation(()=>e.write(i.nfd,a.buffer,c,l,d))},llseek(i,a,c){n?.("llseek stream",s.realPath(i.node),a,c);let l=a;if(c===1?l+=i.position:c===2&&t.isFile(i.node.mode)&&s.tryFSOperation(()=>{let d=e.fstat(i.nfd);l+=d.size}),l<0)throw new t.ErrnoError(28);return l},mmap(i,a,c,l,d){if(n?.("mmap stream",s.realPath(i.node),a,c,l,d),!t.isFile(i.node.mode))throw new t.ErrnoError($e.ENODEV);let p=r.mmapAlloc(a);return s.stream_ops.read(i,r.HEAP8,p,a,c),{ptr:p,allocated:!0}},msync(i,a,c,l,d){return n?.("msync stream",s.realPath(i.node),c,l,d),s.stream_ops.write(i,a,0,l,c),0}}};return s}});var hn={};ue(hn,{NodeFS:()=>lr});var Rt,_t,lr,gn=He(()=>{"use strict";f();Rt=_(require("fs"),1),_t=_(require("path"),1);De();lr=class extends re{constructor(e){super(e),this.rootDir=_t.resolve(e),Rt.existsSync(_t.join(this.rootDir))||Rt.mkdirSync(this.rootDir)}async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],s=>{let i=s.FS.filesystems.NODEFS;s.FS.mkdir(B),s.FS.mount(i,{root:this.rootDir},B)}]}}}async closeFs(){this.pg.Module.FS.quit()}}});var Sn={};ue(Sn,{OpfsAhpFS:()=>dr});var is,ss,ur,Xe,Oe,fe,Je,D,K,N,Ze,ne,ie,V,g,bn,me,Ie,W,O,Ke,wn,pr,dr,E,xn=He(()=>{"use strict";f();De();is="state.txt",ss="data",ur={DIR:16384,FILE:32768},dr=class extends Qe{constructor(t,{initialPoolSize:n=1e3,maintainedPoolSize:s=100,debug:i=!1}={}){super(t,{debug:i});h(this,g);h(this,Xe);h(this,Oe);h(this,fe);h(this,Je);h(this,D);h(this,K,new Map);h(this,N,new Map);h(this,Ze,0);h(this,ne,new Map);h(this,ie,new Map);this.lastCheckpoint=0;this.checkpointInterval=1e3*60;this.poolCounter=0;h(this,V,new Set);this.initialPoolSize=n,this.maintainedPoolSize=s}async init(t,n){return await u(this,g,bn).call(this),super.init(t,n)}async syncToFs(t=!1){await this.maybeCheckpointState(),await this.maintainPool(),t||this.flush()}async closeFs(){for(let t of o(this,N).values())t.close();o(this,D).flush(),o(this,D).close(),this.pg.Module.FS.quit()}async maintainPool(t){t=t||this.maintainedPoolSize;let n=t-this.state.pool.length,s=[];for(let i=0;i<n;i++)s.push(new Promise(async a=>{++this.poolCounter;let c=`${(Date.now()-1704063600).toString(16).padStart(8,"0")}-${this.poolCounter.toString(16).padStart(8,"0")}`,l=await o(this,fe).getFileHandle(c,{create:!0}),d=await l.createSyncAccessHandle();o(this,K).set(c,l),o(this,N).set(c,d),u(this,g,Ie).call(this,{opp:"createPoolFile",args:[c]}),this.state.pool.push(c),a()}));for(let i=0;i>n;i--)s.push(new Promise(async a=>{let c=this.state.pool.pop();u(this,g,Ie).call(this,{opp:"deletePoolFile",args:[c]});let l=o(this,K).get(c);o(this,N).get(c)?.close(),await l.remove().then(()=>{o(this,K).delete(c),o(this,N).delete(c),a()})}));await Promise.all(s)}_createPoolFileState(t){this.state.pool.push(t)}_deletePoolFileState(t){let n=this.state.pool.indexOf(t);n>-1&&this.state.pool.splice(n,1)}async maybeCheckpointState(){Date.now()-this.lastCheckpoint>this.checkpointInterval&&await this.checkpointState()}async checkpointState(){let t=new TextEncoder().encode(JSON.stringify(this.state));o(this,D).truncate(0),o(this,D).write(t,{at:0}),o(this,D).flush(),this.lastCheckpoint=Date.now()}flush(){for(let t of o(this,V))try{t.flush()}catch{}o(this,V).clear()}chmod(t,n){u(this,g,me).call(this,{opp:"chmod",args:[t,n]},()=>{this._chmodState(t,n)})}_chmodState(t,n){let s=u(this,g,O).call(this,t);s.mode=n}close(t){let n=u(this,g,Ke).call(this,t);o(this,ne).delete(t),o(this,ie).delete(n)}fstat(t){let n=u(this,g,Ke).call(this,t);return this.lstat(n)}lstat(t){let n=u(this,g,O).call(this,t),s=n.type==="file"?o(this,N).get(n.backingFilename).getSize():0,i=4096;return{dev:0,ino:0,mode:n.mode,nlink:1,uid:0,gid:0,rdev:0,size:s,blksize:i,blocks:Math.ceil(s/i),atime:n.lastModified,mtime:n.lastModified,ctime:n.lastModified}}mkdir(t,n){u(this,g,me).call(this,{opp:"mkdir",args:[t,n]},()=>{this._mkdirState(t,n)})}_mkdirState(t,n){let s=u(this,g,W).call(this,t),i=s.pop(),a=[],c=this.state.root;for(let d of s){if(a.push(t),!Object.prototype.hasOwnProperty.call(c.children,d))if(n?.recursive)this.mkdir(a.join("/"));else throw new E("ENOENT","No such file or directory");if(c.children[d].type!=="directory")throw new E("ENOTDIR","Not a directory");c=c.children[d]}if(Object.prototype.hasOwnProperty.call(c.children,i))throw new E("EEXIST","File exists");let l={type:"directory",lastModified:Date.now(),mode:n?.mode||ur.DIR,children:{}};c.children[i]=l}open(t,n,s){if(u(this,g,O).call(this,t).type!=="file")throw new E("EISDIR","Is a directory");let a=u(this,g,wn).call(this);return o(this,ne).set(a,t),o(this,ie).set(t,a),a}readdir(t){let n=u(this,g,O).call(this,t);if(n.type!=="directory")throw new E("ENOTDIR","Not a directory");return Object.keys(n.children)}read(t,n,s,i,a){let c=u(this,g,Ke).call(this,t),l=u(this,g,O).call(this,c);if(l.type!=="file")throw new E("EISDIR","Is a directory");return o(this,N).get(l.backingFilename).read(new Uint8Array(n.buffer,s,i),{at:a})}rename(t,n){u(this,g,me).call(this,{opp:"rename",args:[t,n]},()=>{this._renameState(t,n,!0)})}_renameState(t,n,s=!1){let i=u(this,g,W).call(this,t),a=i.pop(),c=u(this,g,O).call(this,i.join("/"));if(!Object.prototype.hasOwnProperty.call(c.children,a))throw new E("ENOENT","No such file or directory");let l=u(this,g,W).call(this,n),d=l.pop(),p=u(this,g,O).call(this,l.join("/"));if(s&&Object.prototype.hasOwnProperty.call(p.children,d)){let m=p.children[d];o(this,N).get(m.backingFilename).truncate(0),this.state.pool.push(m.backingFilename)}p.children[d]=c.children[a],delete c.children[a]}rmdir(t){u(this,g,me).call(this,{opp:"rmdir",args:[t]},()=>{this._rmdirState(t)})}_rmdirState(t){let n=u(this,g,W).call(this,t),s=n.pop(),i=u(this,g,O).call(this,n.join("/"));if(!Object.prototype.hasOwnProperty.call(i.children,s))throw new E("ENOENT","No such file or directory");let a=i.children[s];if(a.type!=="directory")throw new E("ENOTDIR","Not a directory");if(Object.keys(a.children).length>0)throw new E("ENOTEMPTY","Directory not empty");delete i.children[s]}truncate(t,n=0){let s=u(this,g,O).call(this,t);if(s.type!=="file")throw new E("EISDIR","Is a directory");let i=o(this,N).get(s.backingFilename);if(!i)throw new E("ENOENT","No such file or directory");i.truncate(n),o(this,V).add(i)}unlink(t){u(this,g,me).call(this,{opp:"unlink",args:[t]},()=>{this._unlinkState(t,!0)})}_unlinkState(t,n=!1){let s=u(this,g,W).call(this,t),i=s.pop(),a=u(this,g,O).call(this,s.join("/"));if(!Object.prototype.hasOwnProperty.call(a.children,i))throw new E("ENOENT","No such file or directory");let c=a.children[i];if(c.type!=="file")throw new E("EISDIR","Is a directory");if(delete a.children[i],n){let l=o(this,N).get(c.backingFilename);l?.truncate(0),o(this,V).add(l),o(this,ie).has(t)&&(o(this,ne).delete(o(this,ie).get(t)),o(this,ie).delete(t))}this.state.pool.push(c.backingFilename)}utimes(t,n,s){u(this,g,me).call(this,{opp:"utimes",args:[t,n,s]},()=>{this._utimesState(t,n,s)})}_utimesState(t,n,s){let i=u(this,g,O).call(this,t);i.lastModified=s}writeFile(t,n,s){let i=u(this,g,W).call(this,t),a=i.pop(),c=u(this,g,O).call(this,i.join("/"));if(Object.prototype.hasOwnProperty.call(c.children,a)){let p=c.children[a];p.lastModified=Date.now(),u(this,g,Ie).call(this,{opp:"setLastModified",args:[t,p.lastModified]})}else{if(this.state.pool.length===0)throw new Error("No more file handles available in the pool");let p={type:"file",lastModified:Date.now(),mode:s?.mode||ur.FILE,backingFilename:this.state.pool.pop()};c.children[a]=p,u(this,g,Ie).call(this,{opp:"createFileNode",args:[t,p]})}let l=c.children[a],d=o(this,N).get(l.backingFilename);n.length>0&&(d.write(typeof n=="string"?new TextEncoder().encode(n):new Uint8Array(n),{at:0}),t.startsWith("/pg_wal")&&o(this,V).add(d))}_createFileNodeState(t,n){let s=u(this,g,W).call(this,t),i=s.pop(),a=u(this,g,O).call(this,s.join("/"));a.children[i]=n;let c=this.state.pool.indexOf(n.backingFilename);return c>-1&&this.state.pool.splice(c,1),n}_setLastModifiedState(t,n){let s=u(this,g,O).call(this,t);s.lastModified=n}write(t,n,s,i,a){let c=u(this,g,Ke).call(this,t),l=u(this,g,O).call(this,c);if(l.type!=="file")throw new E("EISDIR","Is a directory");let d=o(this,N).get(l.backingFilename);if(!d)throw new E("EBADF","Bad file descriptor");let p=d.write(new Uint8Array(n,s,i),{at:a});return c.startsWith("/pg_wal")&&o(this,V).add(d),p}};Xe=new WeakMap,Oe=new WeakMap,fe=new WeakMap,Je=new WeakMap,D=new WeakMap,K=new WeakMap,N=new WeakMap,Ze=new WeakMap,ne=new WeakMap,ie=new WeakMap,V=new WeakMap,g=new WeakSet,bn=async function(){y(this,Xe,await navigator.storage.getDirectory()),y(this,Oe,await u(this,g,pr).call(this,this.dataDir,{create:!0})),y(this,fe,await u(this,g,pr).call(this,ss,{from:o(this,Oe),create:!0})),y(this,Je,await o(this,Oe).getFileHandle(is,{create:!0})),y(this,D,await o(this,Je).createSyncAccessHandle());let t=new ArrayBuffer(o(this,D).getSize());o(this,D).read(t,{at:0});let n,s=new TextDecoder().decode(t).split(`
`),i=!1;try{n=JSON.parse(s[0])}catch{n={root:{type:"directory",lastModified:Date.now(),mode:ur.DIR,children:{}},pool:[]},o(this,D).truncate(0),o(this,D).write(new TextEncoder().encode(JSON.stringify(n)),{at:0}),i=!0}this.state=n;let a=s.slice(1).filter(Boolean).map(p=>JSON.parse(p));for(let p of a){let m=`_${p.opp}State`;if(typeof this[m]=="function")try{this[m].bind(this)(...p.args)}catch(x){console.warn("Error applying OPFS AHP WAL entry",p,x)}}let c=[],l=async p=>{if(p.type==="file")try{let m=await o(this,fe).getFileHandle(p.backingFilename),x=await m.createSyncAccessHandle();o(this,K).set(p.backingFilename,m),o(this,N).set(p.backingFilename,x)}catch(m){console.error("Error opening file handle for node",p,m)}else for(let m of Object.values(p.children))c.push(l(m))};await l(this.state.root);let d=[];for(let p of this.state.pool)d.push(new Promise(async m=>{o(this,K).has(p)&&console.warn("File handle already exists for pool file",p);let x=await o(this,fe).getFileHandle(p),T=await x.createSyncAccessHandle();o(this,K).set(p,x),o(this,N).set(p,T),m()}));await Promise.all([...c,...d]),await this.maintainPool(i?this.initialPoolSize:this.maintainedPoolSize)},me=function(t,n){let s=u(this,g,Ie).call(this,t);try{n()}catch(i){throw o(this,D).truncate(s),i}},Ie=function(t){let n=JSON.stringify(t),s=new TextEncoder().encode(`
${n}`),i=o(this,D).getSize();return o(this,D).write(s,{at:i}),o(this,V).add(o(this,D)),i},W=function(t){return t.split("/").filter(Boolean)},O=function(t,n){let s=u(this,g,W).call(this,t),i=n||this.state.root;for(let a of s){if(i.type!=="directory")throw new E("ENOTDIR","Not a directory");if(!Object.prototype.hasOwnProperty.call(i.children,a))throw new E("ENOENT","No such file or directory");i=i.children[a]}return i},Ke=function(t){let n=o(this,ne).get(t);if(!n)throw new E("EBADF","Bad file descriptor");return n},wn=function(){let t=++de(this,Ze)._;for(;o(this,ne).has(t);)de(this,Ze)._++;return t},pr=async function(t,n){let s=u(this,g,W).call(this,t),i=n?.from||o(this,Xe);for(let a of s)i=await i.getDirectoryHandle(a,{create:n?.create});return i};E=class extends Error{constructor(e,t){super(t),typeof e=="number"?this.code=e:typeof e=="string"&&(this.code=$e[e])}}});var Oa={};ue(Oa,{IdbFs:()=>ve,MemoryFS:()=>Me,Mutex:()=>ee,PGlite:()=>jr,formatQuery:()=>ii,messages:()=>yt,parse:()=>Cr,protocol:()=>Fr,types:()=>Ur,uuid:()=>ni});module.exports=fi(Oa);f();f();f();var _a=new Error("timeout while waiting for mutex to become available"),Ba=new Error("mutex already locked"),hi=new Error("request for lock canceled"),gi=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(p){try{d(n.next(p))}catch(m){a(m)}}function l(p){try{d(n.throw(p))}catch(m){a(m)}}function d(p){p.done?i(p.value):s(p.value).then(c,l)}d((n=n.apply(r,e||[])).next())})},Jt=class{constructor(e,t=hi){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,n)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:n}),this._dispatch()})}runExclusive(e,t=1){return gi(this,void 0,void 0,function*(){let[n,s]=yield this.acquire(t);try{return yield e(n)}finally{s()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let n=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!n)continue;let s=this._value,i=t;this._value-=t,t=this._value+1,n.resolve([s,this._newReleaser(i)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},bi=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function c(p){try{d(n.next(p))}catch(m){a(m)}}function l(p){try{d(n.throw(p))}catch(m){a(m)}}function d(p){p.done?i(p.value):s(p.value).then(c,l)}d((n=n.apply(r,e||[])).next())})},ee=class{constructor(e){this._semaphore=new Jt(1,e)}acquire(){return bi(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};f();var $r=_(require("./postgres.cjs").default,1),Yr=$r.default;f();f();De();var ve=class extends re{async init(e,t){return this.pg=e,{emscriptenOpts:{...t,preRun:[...t.preRun||[],s=>{let i=s.FS.filesystems.IDBFS;s.FS.mkdir("/pglite"),s.FS.mkdir(`/pglite/${this.dataDir}`),s.FS.mount(i,{},`/pglite/${this.dataDir}`),s.FS.symlink(`/pglite/${this.dataDir}`,B)}]}}}initialSyncFs(){return new Promise((e,t)=>{this.pg.Module.FS.syncfs(!0,n=>{n?t(n):e()})})}syncToFs(e){return new Promise((t,n)=>{this.pg.Module.FS.syncfs(!1,s=>{s?n(s):t()})})}async closeFs(){let e=this.pg.Module.FS.filesystems.IDBFS.dbs[this.dataDir];e&&e.close(),this.pg.Module.FS.quit()}};f();De();var Me=class extends re{async closeFs(){this.pg.Module.FS.quit()}};De();function Pn(r){let e;if(r?.startsWith("file://")){if(r=r.slice(7),!r)throw new Error("Invalid dataDir, must be a valid path");e="nodefs"}else r?.startsWith("idb://")?(r=r.slice(6),e="idbfs"):r?.startsWith("opfs-ahp://")?(r=r.slice(11),e="opfs-ahp"):!r||r?.startsWith("memory://")?e="memoryfs":e="nodefs";return{dataDir:r,fsType:e}}async function An(r,e){let t;if(r&&e==="nodefs"){let{NodeFS:n}=await Promise.resolve().then(()=>(gn(),hn));t=new n(r)}else if(r&&e==="idbfs")t=new ve(r);else if(r&&e==="opfs-ahp"){let{OpfsAhpFS:n}=await Promise.resolve().then(()=>(xn(),Sn));t=new n(r)}else t=new Me;return t}f();var Fr={};ue(Fr,{Parser:()=>we,messages:()=>yt,serialize:()=>I});f();f();f();f();function Ne(r){let e=r.length;for(let t=r.length-1;t>=0;t--){let n=r.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}var v,M,_e,kt,Be,L,Bt,Re,Tn,ye=class{constructor(e=256){this.size=e;h(this,L);h(this,v);h(this,M,5);h(this,_e,!1);h(this,kt,new TextEncoder);h(this,Be,0);y(this,v,u(this,L,Bt).call(this,e))}addInt32(e){return u(this,L,Re).call(this,4),o(this,v).setInt32(o(this,M),e,o(this,_e)),y(this,M,o(this,M)+4),this}addInt16(e){return u(this,L,Re).call(this,2),o(this,v).setInt16(o(this,M),e,o(this,_e)),y(this,M,o(this,M)+2),this}addCString(e){return e&&this.addString(e),u(this,L,Re).call(this,1),o(this,v).setUint8(o(this,M),0),de(this,M)._++,this}addString(e=""){let t=Ne(e);return u(this,L,Re).call(this,t),o(this,kt).encodeInto(e,new Uint8Array(o(this,v).buffer,o(this,M))),y(this,M,o(this,M)+t),this}add(e){return u(this,L,Re).call(this,e.byteLength),new Uint8Array(o(this,v).buffer).set(new Uint8Array(e),o(this,M)),y(this,M,o(this,M)+e.byteLength),this}flush(e){let t=u(this,L,Tn).call(this,e);return y(this,M,5),y(this,v,u(this,L,Bt).call(this,this.size)),new Uint8Array(t)}};v=new WeakMap,M=new WeakMap,_e=new WeakMap,kt=new WeakMap,Be=new WeakMap,L=new WeakSet,Bt=function(e){return new DataView(new ArrayBuffer(e))},Re=function(e){if(o(this,v).byteLength-o(this,M)<e){let n=o(this,v).buffer,s=n.byteLength+(n.byteLength>>1)+e;y(this,v,u(this,L,Bt).call(this,s)),new Uint8Array(o(this,v).buffer).set(new Uint8Array(n))}},Tn=function(e){if(e){o(this,v).setUint8(o(this,Be),e);let t=o(this,M)-(o(this,Be)+1);o(this,v).setInt32(o(this,Be)+1,t,o(this,_e))}return o(this,v).buffer.slice(e?0:5,o(this,M))};var A=new ye,as=r=>{A.addInt16(3).addInt16(0);for(let n of Object.keys(r))A.addCString(n).addCString(r[n]);A.addCString("client_encoding").addCString("UTF8");let e=A.addCString("").flush(),t=e.byteLength+4;return new ye().addInt32(t).add(e).flush()},os=()=>{let r=new DataView(new ArrayBuffer(8));return r.setInt32(0,8,!1),r.setInt32(4,80877103,!1),new Uint8Array(r.buffer)},cs=r=>A.addCString(r).flush(112),ls=(r,e)=>(A.addCString(r).addInt32(Ne(e)).addString(e),A.flush(112)),us=r=>A.addString(r).flush(112),ds=r=>A.addCString(r).flush(81),ps=[],ms=r=>{let e=r.name??"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=A.addCString(e).addCString(r.text).addInt16(r.types?.length??0);return r.types?.forEach(n=>t.addInt32(n)),A.flush(80)},ke=new ye;var fs=(r,e)=>{for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];if(n===null)A.addInt16(0),ke.addInt32(-1);else if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)){let s=ArrayBuffer.isView(n)?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):n;A.addInt16(1),ke.addInt32(s.byteLength),ke.add(s)}else A.addInt16(0),ke.addInt32(Ne(n)),ke.addString(n)}},ys=(r={})=>{let e=r.portal??"",t=r.statement??"",n=r.binary??!1,s=r.values??ps,i=s.length;return A.addCString(e).addCString(t),A.addInt16(i),fs(s,r.valueMapper),A.addInt16(i),A.add(ke.flush()),A.addInt16(n?1:0),A.flush(66)},hs=new Uint8Array([69,0,0,0,9,0,0,0,0,0]),gs=r=>{if(!r||!r.portal&&!r.rows)return hs;let e=r.portal??"",t=r.rows??0,n=Ne(e),s=4+n+1+4,i=new DataView(new ArrayBuffer(1+s));return i.setUint8(0,69),i.setInt32(1,s,!1),new TextEncoder().encodeInto(e,new Uint8Array(i.buffer,5)),i.setUint8(n+5,0),i.setUint32(i.byteLength-4,t,!1),new Uint8Array(i.buffer)},bs=(r,e)=>{let t=new DataView(new ArrayBuffer(16));return t.setInt32(0,16,!1),t.setInt16(4,1234,!1),t.setInt16(6,5678,!1),t.setInt32(8,r,!1),t.setInt32(12,e,!1),new Uint8Array(t.buffer)},mr=(r,e)=>{let t=new ye;return t.addCString(e),t.flush(r)},ws=A.addCString("P").flush(68),Ss=A.addCString("S").flush(68),xs=r=>r.name?mr(68,`${r.type}${r.name??""}`):r.type==="P"?ws:Ss,Ps=r=>{let e=`${r.type}${r.name??""}`;return mr(67,e)},As=r=>A.add(r).flush(100),Ts=r=>mr(102,r),Ut=r=>new Uint8Array([r,0,0,0,4]),Es=Ut(72),Fs=Ut(83),Ds=Ut(88),vs=Ut(99),I={startup:as,password:cs,requestSsl:os,sendSASLInitialResponseMessage:ls,sendSCRAMClientFinalMessage:us,query:ds,parse:ms,bind:ys,execute:gs,describe:xs,close:Ps,flush:()=>Es,sync:()=>Fs,end:()=>Ds,copyData:As,copyDone:()=>vs,copyFail:Ts,cancel:bs};f();var yt={};ue(yt,{AuthenticationCleartextPassword:()=>tt,AuthenticationMD5Password:()=>rt,AuthenticationOk:()=>et,AuthenticationSASL:()=>nt,AuthenticationSASLContinue:()=>it,AuthenticationSASLFinal:()=>st,BackendKeyDataMessage:()=>pt,CommandCompleteMessage:()=>ge,CopyDataMessage:()=>at,CopyResponse:()=>ot,DataRowMessage:()=>ft,DatabaseError:()=>se,Field:()=>ct,NoticeMessage:()=>be,NotificationResponseMessage:()=>he,ParameterDescriptionMessage:()=>ut,ParameterStatusMessage:()=>dt,ReadyForQueryMessage:()=>mt,RowDescriptionMessage:()=>lt,bindComplete:()=>yr,closeComplete:()=>hr,copyDone:()=>xr,emptyQuery:()=>Sr,noData:()=>gr,parseComplete:()=>fr,portalSuspended:()=>br,replicationStart:()=>wr});f();var fr={name:"parseComplete",length:5},yr={name:"bindComplete",length:5},hr={name:"closeComplete",length:5},gr={name:"noData",length:5},br={name:"portalSuspended",length:5},wr={name:"replicationStart",length:4},Sr={name:"emptyQuery",length:4},xr={name:"copyDone",length:4},et=class{constructor(e){this.length=e;this.name="authenticationOk"}},tt=class{constructor(e){this.length=e;this.name="authenticationCleartextPassword"}},rt=class{constructor(e,t){this.length=e;this.salt=t;this.name="authenticationMD5Password"}},nt=class{constructor(e,t){this.length=e;this.mechanisms=t;this.name="authenticationSASL"}},it=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLContinue"}},st=class{constructor(e,t){this.length=e;this.data=t;this.name="authenticationSASLFinal"}},se=class extends Error{constructor(t,n,s){super(t);this.length=n;this.name=s}},at=class{constructor(e,t){this.length=e;this.chunk=t;this.name="copyData"}},ot=class{constructor(e,t,n,s){this.length=e;this.name=t;this.binary=n;this.columnTypes=new Array(s)}},ct=class{constructor(e,t,n,s,i,a,c){this.name=e;this.tableID=t;this.columnID=n;this.dataTypeID=s;this.dataTypeSize=i;this.dataTypeModifier=a;this.format=c}},lt=class{constructor(e,t){this.length=e;this.fieldCount=t;this.name="rowDescription";this.fields=new Array(this.fieldCount)}},ut=class{constructor(e,t){this.length=e;this.parameterCount=t;this.name="parameterDescription";this.dataTypeIDs=new Array(this.parameterCount)}},dt=class{constructor(e,t,n){this.length=e;this.parameterName=t;this.parameterValue=n;this.name="parameterStatus"}},pt=class{constructor(e,t,n){this.length=e;this.processID=t;this.secretKey=n;this.name="backendKeyData"}},he=class{constructor(e,t,n,s){this.length=e;this.processId=t;this.channel=n;this.payload=s;this.name="notification"}},mt=class{constructor(e,t){this.length=e;this.status=t;this.name="readyForQuery"}},ge=class{constructor(e,t){this.length=e;this.text=t;this.name="commandComplete"}},ft=class{constructor(e,t){this.length=e;this.fields=t;this.name="dataRow";this.fieldCount=t.length}},be=class{constructor(e,t){this.length=e;this.message=t;this.name="notice"}};f();var Pr={text:0,binary:1};f();var Ms=new ArrayBuffer(0),X,R,Lt,zt,ht,Ct=class{constructor(e=0){h(this,X,new DataView(Ms));h(this,R);h(this,Lt,"utf-8");h(this,zt,new TextDecoder(o(this,Lt)));h(this,ht,!1);y(this,R,e)}setBuffer(e,t){y(this,R,e),y(this,X,new DataView(t))}int16(){let e=o(this,X).getInt16(o(this,R),o(this,ht));return y(this,R,o(this,R)+2),e}byte(){let e=o(this,X).getUint8(o(this,R));return de(this,R)._++,e}int32(){let e=o(this,X).getInt32(o(this,R),o(this,ht));return y(this,R,o(this,R)+4),e}string(e){return o(this,zt).decode(this.bytes(e))}cstring(){let e=o(this,R),t=e;for(;o(this,X).getUint8(t++)!==0;);let n=this.string(t-e-1);return y(this,R,t),n}bytes(e){let t=o(this,X).buffer.slice(o(this,R),o(this,R)+e);return y(this,R,o(this,R)+e),new Uint8Array(t)}};X=new WeakMap,R=new WeakMap,Lt=new WeakMap,zt=new WeakMap,ht=new WeakMap;var Ar=1,Is=4,En=Ar+Is,Fn=new ArrayBuffer(0);var k,z,G,b,w,Dn,vn,Mn,In,On,Nn,Rn,Tr,_n,Bn,kn,Un,Cn,Ln,zn,Gn,Er,we=class{constructor(){h(this,w);h(this,k,new DataView(Fn));h(this,z,0);h(this,G,0);h(this,b,new Ct)}parse(e,t){u(this,w,Dn).call(this,ArrayBuffer.isView(e)?e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):e);let n=o(this,G)+o(this,z),s=o(this,G);for(;s+En<=n;){let i=o(this,k).getUint8(s),a=o(this,k).getUint32(s+Ar,!1),c=Ar+a;if(c+s<=n){let l=u(this,w,vn).call(this,s+En,i,a,o(this,k).buffer);t(l),s+=c}else break}s===n?(y(this,k,new DataView(Fn)),y(this,z,0),y(this,G,0)):(y(this,z,n-s),y(this,G,s))}};k=new WeakMap,z=new WeakMap,G=new WeakMap,b=new WeakMap,w=new WeakSet,Dn=function(e){if(o(this,z)>0){let t=o(this,z)+e.byteLength;if(t+o(this,G)>o(this,k).byteLength){let s;if(t<=o(this,k).byteLength&&o(this,G)>=o(this,z))s=o(this,k).buffer;else{let i=o(this,k).byteLength*2;for(;t>=i;)i*=2;s=new ArrayBuffer(i)}new Uint8Array(s).set(new Uint8Array(o(this,k).buffer,o(this,G),o(this,z))),y(this,k,new DataView(s)),y(this,G,0)}new Uint8Array(o(this,k).buffer).set(new Uint8Array(e),o(this,G)+o(this,z)),y(this,z,t)}else y(this,k,new DataView(e)),y(this,G,0),y(this,z,e.byteLength)},vn=function(e,t,n,s){switch(t){case 50:return yr;case 49:return fr;case 51:return hr;case 110:return gr;case 115:return br;case 99:return xr;case 87:return wr;case 73:return Sr;case 68:return u(this,w,Cn).call(this,e,n,s);case 67:return u(this,w,In).call(this,e,n,s);case 90:return u(this,w,Mn).call(this,e,n,s);case 65:return u(this,w,_n).call(this,e,n,s);case 82:return u(this,w,Gn).call(this,e,n,s);case 83:return u(this,w,Ln).call(this,e,n,s);case 75:return u(this,w,zn).call(this,e,n,s);case 69:return u(this,w,Er).call(this,e,n,s,"error");case 78:return u(this,w,Er).call(this,e,n,s,"notice");case 84:return u(this,w,Bn).call(this,e,n,s);case 116:return u(this,w,Un).call(this,e,n,s);case 71:return u(this,w,Nn).call(this,e,n,s);case 72:return u(this,w,Rn).call(this,e,n,s);case 100:return u(this,w,On).call(this,e,n,s);default:return new se("received invalid response: "+t.toString(16),n,"error")}},Mn=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).string(1);return new mt(t,s)},In=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).cstring();return new ge(t,s)},On=function(e,t,n){let s=n.slice(e,e+(t-4));return new at(t,new Uint8Array(s))},Nn=function(e,t,n){return u(this,w,Tr).call(this,e,t,n,"copyInResponse")},Rn=function(e,t,n){return u(this,w,Tr).call(this,e,t,n,"copyOutResponse")},Tr=function(e,t,n,s){o(this,b).setBuffer(e,n);let i=o(this,b).byte()!==0,a=o(this,b).int16(),c=new ot(t,s,i,a);for(let l=0;l<a;l++)c.columnTypes[l]=o(this,b).int16();return c},_n=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).int32(),i=o(this,b).cstring(),a=o(this,b).cstring();return new he(t,s,i,a)},Bn=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).int16(),i=new lt(t,s);for(let a=0;a<s;a++)i.fields[a]=u(this,w,kn).call(this);return i},kn=function(){let e=o(this,b).cstring(),t=o(this,b).int32(),n=o(this,b).int16(),s=o(this,b).int32(),i=o(this,b).int16(),a=o(this,b).int32(),c=o(this,b).int16()===0?Pr.text:Pr.binary;return new ct(e,t,n,s,i,a,c)},Un=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).int16(),i=new ut(t,s);for(let a=0;a<s;a++)i.dataTypeIDs[a]=o(this,b).int32();return i},Cn=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).int16(),i=new Array(s);for(let a=0;a<s;a++){let c=o(this,b).int32();i[a]=c===-1?null:o(this,b).string(c)}return new ft(t,i)},Ln=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).cstring(),i=o(this,b).cstring();return new dt(t,s,i)},zn=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).int32(),i=o(this,b).int32();return new pt(t,s,i)},Gn=function(e,t,n){o(this,b).setBuffer(e,n);let s=o(this,b).int32();switch(s){case 0:return new et(t);case 3:return new tt(t);case 5:return new rt(t,o(this,b).bytes(4));case 10:{let i=[];for(;;){let a=o(this,b).cstring();if(a.length===0)return new nt(t,i);i.push(a)}}case 11:return new it(t,o(this,b).string(t-8));case 12:return new st(t,o(this,b).string(t-8));default:throw new Error("Unknown authenticationOk message type "+s)}},Er=function(e,t,n,s){o(this,b).setBuffer(e,n);let i={},a=o(this,b).string(1);for(;a!=="\0";)i[a]=o(this,b).cstring(),a=o(this,b).string(1);let c=i.M,l=s==="notice"?new be(t,c):new se(c,t,s);return l.severity=i.S,l.code=i.C,l.detail=i.D,l.hint=i.H,l.position=i.P,l.internalPosition=i.p,l.internalQuery=i.q,l.where=i.W,l.schema=i.s,l.table=i.t,l.column=i.c,l.dataType=i.d,l.constraint=i.n,l.file=i.F,l.line=i.L,l.routine=i.R,l};var Cr={};ue(Cr,{parseDescribeStatementResults:()=>bt,parseResults:()=>Ht});f();var Ur={};ue(Ur,{ABSTIME:()=>qs,ACLITEM:()=>Js,BIT:()=>ra,BOOL:()=>vr,BPCHAR:()=>Qn,BYTEA:()=>Mr,CHAR:()=>Rs,CID:()=>Us,CIDR:()=>Hs,CIRCLE:()=>Qs,DATE:()=>Yn,FLOAT4:()=>Wn,FLOAT8:()=>Vn,GTSVECTOR:()=>ba,INET:()=>Xs,INT2:()=>jn,INT4:()=>Hn,INT8:()=>Ir,INTERVAL:()=>ea,JSON:()=>Or,JSONB:()=>Xn,MACADDR:()=>Ks,MACADDR8:()=>$s,MONEY:()=>Ys,NUMERIC:()=>ia,OID:()=>qn,PATH:()=>Gs,PG_DEPENDENCIES:()=>ya,PG_LSN:()=>ma,PG_NDISTINCT:()=>fa,PG_NODE_TREE:()=>Ls,POLYGON:()=>js,REFCURSOR:()=>sa,REGCLASS:()=>la,REGCONFIG:()=>wa,REGDICTIONARY:()=>Sa,REGNAMESPACE:()=>xa,REGOPER:()=>oa,REGOPERATOR:()=>ca,REGPROC:()=>_s,REGPROCEDURE:()=>aa,REGROLE:()=>Pa,REGTYPE:()=>ua,RELTIME:()=>Ws,SMGR:()=>zs,TEXT:()=>gt,TID:()=>Bs,TIME:()=>Zs,TIMESTAMP:()=>Kn,TIMESTAMPTZ:()=>Nr,TIMETZ:()=>ta,TINTERVAL:()=>Vs,TSQUERY:()=>ga,TSVECTOR:()=>ha,TXID_SNAPSHOT:()=>pa,UUID:()=>da,VARBIT:()=>na,VARCHAR:()=>$n,XID:()=>ks,XML:()=>Cs,arrayParser:()=>kr,arraySerializer:()=>jt,parseType:()=>Gt,parsers:()=>_r,serializers:()=>Br,types:()=>Jn});f();var Os=globalThis.JSON.parse,Ns=globalThis.JSON.stringify,vr=16,Mr=17,Rs=18,Ir=20,jn=21,Hn=23,_s=24,gt=25,qn=26,Bs=27,ks=28,Us=29,Or=114,Cs=142,Ls=194,zs=210,Gs=602,js=604,Hs=650,Wn=700,Vn=701,qs=702,Ws=703,Vs=704,Qs=718,$s=774,Ys=790,Ks=829,Xs=869,Js=1033,Qn=1042,$n=1043,Yn=1082,Zs=1083,Kn=1114,Nr=1184,ea=1186,ta=1266,ra=1560,na=1562,ia=1700,sa=1790,aa=2202,oa=2203,ca=2204,la=2205,ua=2206,da=2950,pa=2970,ma=3220,fa=3361,ya=3402,ha=3614,ga=3615,ba=3642,wa=3734,Sa=3769,Xn=3802,xa=4089,Pa=4096,Jn={string:{to:gt,from:[gt,$n,Qn],serialize:r=>{if(typeof r=="string")return r;if(typeof r=="number")return r.toString();throw new Error("Invalid input for string type")},parse:r=>r},number:{to:0,from:[jn,Hn,qn,Wn,Vn],serialize:r=>r.toString(),parse:r=>+r},bigint:{to:Ir,from:[Ir],serialize:r=>r.toString(),parse:r=>{let e=BigInt(r);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:Or,from:[Or,Xn],serialize:r=>typeof r=="string"?r:Ns(r),parse:r=>Os(r)},boolean:{to:vr,from:[vr],serialize:r=>{if(typeof r!="boolean")throw new Error("Invalid input for boolean type");return r?"t":"f"},parse:r=>r==="t"},date:{to:Nr,from:[Yn,Kn,Nr],serialize:r=>{if(typeof r=="string")return r;if(typeof r=="number")return new Date(r).toISOString();if(r instanceof Date)return r.toISOString();throw new Error("Invalid input for date type")},parse:r=>new Date(r)},bytea:{to:Mr,from:[Mr],serialize:r=>{if(!(r instanceof Uint8Array))throw new Error("Invalid input for bytea type");return"\\x"+Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")},parse:r=>{let e=r.slice(2);return Uint8Array.from({length:e.length/2},(t,n)=>parseInt(e.substring(n*2,(n+1)*2),16))}}},Rr=Aa(Jn),_r=Rr.parsers,Br=Rr.serializers;function Gt(r,e,t){if(r===null)return null;let n=t?.[e]??Rr.parsers[e];return n?n(r,e):r}function Aa(r){return Object.keys(r).reduce(({parsers:e,serializers:t},n)=>{let{to:s,from:i,serialize:a,parse:c}=r[n];return t[s]=a,t[n]=a,e[n]=c,Array.isArray(i)?i.forEach(l=>{e[l]=c,t[l]=a}):(e[i]=c,t[i]=a),{parsers:e,serializers:t}},{parsers:{},serializers:{}})}var Ta=/\\/g,Ea=/"/g;function Fa(r){return r.replace(Ta,"\\\\").replace(Ea,'\\"')}function jt(r,e,t){if(Array.isArray(r)===!1)return r;if(!r.length)return"{}";let n=r[0],s=t===1020?";":",";return Array.isArray(n)?`{${r.map(i=>jt(i,e,t)).join(s)}}`:`{${r.map(i=>(i===void 0&&(i=null),i===null?"null":'"'+Fa(e?e(i):i.toString())+'"')).join(s)}}`}var Dr={i:0,char:null,str:"",quoted:!1,last:0,p:null};function kr(r,e,t){return Dr.i=Dr.last=0,Zn(Dr,r,e,t)[0]}function Zn(r,e,t,n){let s=[],i=n===1020?";":",";for(;r.i<e.length;r.i++){if(r.char=e[r.i],r.quoted)r.char==="\\"?r.str+=e[++r.i]:r.char==='"'?(s.push(t?t(r.str):r.str),r.str="",r.quoted=e[r.i+1]==='"',r.last=r.i+2):r.str+=r.char;else if(r.char==='"')r.quoted=!0;else if(r.char==="{")r.last=++r.i,s.push(Zn(r,e,t,n));else if(r.char==="}"){r.quoted=!1,r.last<r.i&&s.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1;break}else r.char===i&&r.p!=="}"&&r.p!=='"'&&(s.push(t?t(e.slice(r.last,r.i)):e.slice(r.last,r.i)),r.last=r.i+1);r.p=r.char}return r.last<r.i&&s.push(t?t(e.slice(r.last,r.i+1)):e.slice(r.last,r.i+1)),s}function Ht(r,e,t,n){let s=[],i={rows:[],fields:[]},a=0,c={...e,...t?.parsers},l=r.filter(d=>d.name==="rowDescription"||d.name==="dataRow"||d.name==="commandComplete");return l.forEach((d,p)=>{if(d.name==="rowDescription"){let m=d;i.fields=m.fields.map(x=>({name:x.name,dataTypeID:x.dataTypeID}))}else if(d.name==="dataRow"&&i){let m=d;t?.rowMode==="array"?i.rows.push(m.fields.map((x,T)=>Gt(x,i.fields[T].dataTypeID,c))):i.rows.push(Object.fromEntries(m.fields.map((x,T)=>[i.fields[T].name,Gt(x,i.fields[T].dataTypeID,c)])))}else d.name==="commandComplete"&&(a+=Da(d),p===l.length-1?s.push({...i,affectedRows:a,...n?{blob:n}:{}}):s.push(i),i={rows:[],fields:[]})}),s.length===0&&s.push({rows:[],fields:[]}),s}function Da(r){let e=r.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}function bt(r){let e=r.find(t=>t.name==="parameterDescription");return e?e.dataTypeIDs:[]}var St=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",wt;async function ei(){if(St||wt)return;let r=new URL("./postgres.wasm",S);wt=fetch(r)}var Ue;async function ti(r,e){if(e||Ue)return WebAssembly.instantiate(e||Ue,r),{instance:await WebAssembly.instantiate(e||Ue,r),module:e||Ue};let t=new URL("./postgres.wasm",S);if(St){let s=await(await import("fs/promises")).readFile(t),{module:i,instance:a}=await WebAssembly.instantiate(s,r);return Ue=i,{instance:a,module:i}}else{wt||(wt=fetch(t));let n=await wt,{module:s,instance:i}=await WebAssembly.instantiateStreaming(n,r);return Ue=s,{instance:i,module:s}}}async function ri(){let r=new URL("./postgres.data",S);return St?(await(await import("fs/promises")).readFile(r)).buffer:(await fetch(r)).arrayBuffer()}var ni=()=>{if(globalThis.crypto?.randomUUID)return globalThis.crypto.randomUUID();let r=new Uint8Array(16);if(globalThis.crypto?.getRandomValues)globalThis.crypto.getRandomValues(r);else for(let t=0;t<r.length;t++)r[t]=Math.floor(Math.random()*256);r[6]=r[6]&15|64,r[8]=r[8]&63|128;let e=[];return r.forEach(t=>{e.push(t.toString(16).padStart(2,"0"))}),e.slice(0,4).join("")+"-"+e.slice(4,6).join("")+"-"+e.slice(6,8).join("")+"-"+e.slice(8,10).join("")+"-"+e.slice(10).join("")};async function ii(r,e,t,n){if(!t||t.length===0)return e;n=n??r;let s;try{await r.execProtocol(I.parse({text:e}),{syncToFs:!1}),s=bt((await r.execProtocol(I.describe({type:"S"}),{syncToFs:!1})).map(([c])=>c))}finally{await r.execProtocol(I.sync(),{syncToFs:!1})}let i=e.replace(/\$([0-9]+)/g,(c,l)=>"%"+l+"L");return(await n.query(`SELECT format($1, ${t.map((c,l)=>`$${l+2}`).join(", ")}) as query`,[i,...t],{paramTypes:[gt,...s]})).rows[0].query}f();f();var si={part:"part",container:"container"};function qt(r,e,...t){let n=r.length-1,s=t.length-1;if(s!==-1){if(s===0){r[n]=r[n]+t[0]+e;return}r[n]=r[n]+t[0],r.push(...t.slice(1,s)),r.push(t[s]+e)}}function va(r,...e){let t=[r[0]];t.raw=[r.raw[0]];let n=[];for(let s=0;s<e.length;s++){let i=e[s],a=s+1;if(i?._templateType===si.part){qt(t,r[a],i.str),qt(t.raw,r.raw[a],i.str);continue}if(i?._templateType===si.container){qt(t,r[a],...i.strings),qt(t.raw,r.raw[a],...i.strings.raw),n.push(...i.values);continue}t.push(r[a]),t.raw.push(r.raw[a]),n.push(i)}return{_templateType:"container",strings:t,values:n}}function Lr(r,...e){let{strings:t,values:n}=va(r,...e);return{query:[t[0],...n.flatMap((s,i)=>[`$${i+1}`,t[i+1]])].join(""),params:n}}var xt,ae,P,J,Wt,Se,zr,Vt=class{constructor(){h(this,P);this.serializers={...Br};this.parsers={..._r};h(this,xt,!1);h(this,ae,!1)}async _initArrayTypes(){if(o(this,xt))return;y(this,xt,!0);let e=await this.query(`
      SELECT b.oid, b.typarray
      FROM pg_catalog.pg_type a
      LEFT JOIN pg_catalog.pg_type b ON b.oid = a.typelem
      WHERE a.typcategory = 'A'
      GROUP BY b.oid, b.typarray
      ORDER BY b.oid
    `);for(let t of e.rows)this.serializers[t.typarray]=n=>jt(n,this.serializers[t.oid],t.typarray),this.parsers[t.typarray]=n=>kr(n,this.parsers[t.oid],t.typarray)}async query(e,t,n){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await u(this,P,Wt).call(this,e,t,n))}async sql(e,...t){let{query:n,params:s}=Lr(e,...t);return await this.query(n,s)}async exec(e,t){return await this._checkReady(),await this._runExclusiveTransaction(async()=>await u(this,P,Se).call(this,e,t))}async transaction(e){return await this._checkReady(),await this._runExclusiveTransaction(async()=>{await u(this,P,Se).call(this,"BEGIN"),y(this,ae,!0);let t=!1,n=()=>{if(t)throw new Error("Transaction is closed")},s={query:async(i,a,c)=>(n(),await u(this,P,Wt).call(this,i,a,c)),sql:async(i,...a)=>{let{query:c,params:l}=Lr(i,...a);return await u(this,P,Wt).call(this,c,l)},exec:async(i,a)=>(n(),await u(this,P,Se).call(this,i,a)),rollback:async()=>{n(),await u(this,P,Se).call(this,"ROLLBACK"),t=!0},get closed(){return t}};try{let i=await e(s);return t||(t=!0,await u(this,P,Se).call(this,"COMMIT")),y(this,ae,!1),i}catch(i){throw t||await u(this,P,Se).call(this,"ROLLBACK"),y(this,ae,!1),i}})}};xt=new WeakMap,ae=new WeakMap,P=new WeakSet,J=async function(e,t={}){return await this.execProtocol(e,{...t,syncToFs:!1})},Wt=async function(e,t=[],n){return await this._runExclusiveQuery(async()=>{u(this,P,zr).call(this,"runQuery",e,t,n),await this._handleBlob(n?.blob);let s;try{let a=await u(this,P,J).call(this,I.parse({text:e,types:n?.paramTypes}),n),c=bt((await u(this,P,J).call(this,I.describe({type:"S"}),n)).map(([d])=>d)),l=t.map((d,p)=>{let m=c[p];if(d==null)return null;let x=this.serializers[m];return x?x(d):d.toString()});s=[...a,...await u(this,P,J).call(this,I.bind({values:l}),n),...await u(this,P,J).call(this,I.describe({type:"P"}),n),...await u(this,P,J).call(this,I.execute({}),n)]}finally{await u(this,P,J).call(this,I.sync(),n)}await this._cleanupBlob(),o(this,ae)||await this.syncToFs();let i=await this._getWrittenBlob();return Ht(s.map(([a])=>a),this.parsers,n,i)[0]})},Se=async function(e,t){return await this._runExclusiveQuery(async()=>{u(this,P,zr).call(this,"runExec",e,t),await this._handleBlob(t?.blob);let n;try{n=await u(this,P,J).call(this,I.query(e),t)}finally{await u(this,P,J).call(this,I.sync(),t)}this._cleanupBlob(),o(this,ae)||await this.syncToFs();let s=await this._getWrittenBlob();return Ht(n.map(([i])=>i),this.parsers,t,s)})},zr=function(...e){this.debug>0&&console.log(...e)};f();var ai=_(ar(),1);async function Gr(r){if(St){let e=await import("fs"),t=await import("zlib"),{Writable:n}=await import("stream"),{pipeline:s}=await import("stream/promises");if(!e.existsSync(r))throw new Error(`Extension bundle not found: ${r}`);let i=t.createGunzip(),a=[];return await s(e.createReadStream(r),i,new n({write(c,l,d){a.push(c),d()}})),new Blob(a)}else{let e=await fetch(r.toString());if(!e.ok||!e.body)return null;if(e.headers.get("Content-Encoding")==="gzip")return e.blob();{let t=new DecompressionStream("gzip");return new Response(e.body.pipeThrough(t)).blob()}}}async function oi(r,e){for(let t in r.pg_extensions){let n;try{n=await r.pg_extensions[t]}catch(s){console.error("Failed to fetch extension:",t,s);continue}if(n){let s=new Uint8Array(await n.arrayBuffer());Ma(r,t,s,e)}else console.error("Could not get binary data for extension:",t)}}function Ma(r,e,t,n){ai.default.untar(t).forEach(i=>{if(!i.name.startsWith(".")){let a=r.WASM_PREFIX+"/"+i.name;if(i.name.endsWith(".so")){let c=(...d)=>{n("pgfs:ext OK",a,d)},l=(...d)=>{n("pgfs:ext FAIL",a,d)};r.FS.createPreloadedFile(Ia(a),i.name.split("/").pop().slice(0,-3),i.data,!0,!0,c,l,!1)}else r.FS.writeFile(a,i.data)}})}function Ia(r){let e=r.lastIndexOf("/");return e>0?r.slice(0,e):r}cr();var Ce,xe,Pe,Le,ze,Qt,$t,Yt,Ge,At,Tt,Et,Ae,oe,j,Te,Z,ci,Pt,Hr=class Hr extends Vt{constructor(t={},n={}){super();h(this,Z);h(this,Ce,!1);h(this,xe,!1);h(this,Pe,!1);h(this,Le,!1);h(this,ze,!1);h(this,Qt,new ee);h(this,$t,new ee);h(this,Yt,new ee);h(this,Ge,!1);this.debug=0;h(this,At);h(this,Tt,[]);h(this,Et,new we);h(this,Ae);h(this,oe);h(this,j,new Map);h(this,Te,new Set);typeof t=="string"?n={dataDir:t,...n}:n=t,this.dataDir=n.dataDir,n?.debug!==void 0&&(this.debug=n.debug),n?.relaxedDurability!==void 0&&y(this,ze,n.relaxedDurability),y(this,At,n.extensions??{}),this.waitReady=u(this,Z,ci).call(this,n??{})}static async create(t,n){let s=typeof t=="string"?{dataDir:t,...n??{}}:t??{},i=new Hr(s);return await i.waitReady,i}get Module(){return this.mod}get ready(){return o(this,Ce)&&!o(this,xe)&&!o(this,Pe)}get closed(){return o(this,Pe)}async close(){await this._checkReady(),y(this,xe,!0);for(let t of o(this,Tt))await t();try{await this.execProtocol(I.end()),this.mod._pg_shutdown()}catch(t){let n=t;if(!(n.name==="ExitStatus"&&n.status===0))throw t}await this.fs.closeFs(),y(this,Pe,!0),y(this,xe,!1)}async[Symbol.asyncDispose](){await this.close()}async _handleBlob(t){y(this,Ae,t?await t.arrayBuffer():void 0)}async _cleanupBlob(){y(this,Ae,void 0)}async _getWrittenBlob(){if(!o(this,oe))return;let t=new Blob(o(this,oe));return y(this,oe,void 0),t}async _checkReady(){if(o(this,xe))throw new Error("PGlite is closing");if(o(this,Pe))throw new Error("PGlite is closed");o(this,Ce)||await this.waitReady}async execProtocolRaw(t,{syncToFs:n=!0}={}){let s=t.length,i=this.mod;i._interactive_write(s),i.HEAPU8.set(t,1),i._interactive_one();let a=s+2,c=a+i._interactive_read(),l=i.HEAPU8.subarray(a,c);return n&&await this.syncToFs(),l}async execProtocol(t,{syncToFs:n=!0,throwOnError:s=!0,onNotice:i}={}){let a=await this.execProtocolRaw(t,{syncToFs:n}),c=[];return o(this,Et).parse(a,l=>{if(l instanceof se){if(y(this,Et,new we),s)throw l}else if(l instanceof be)this.debug>0&&console.warn(l),i&&i(l);else if(l instanceof ge)switch(l.text){case"BEGIN":y(this,Le,!0);break;case"COMMIT":case"ROLLBACK":y(this,Le,!1);break}else if(l instanceof he){let d=o(this,j).get(l.channel);d&&d.forEach(p=>{queueMicrotask(()=>p(l.payload))}),o(this,Te).forEach(p=>{queueMicrotask(()=>p(l.channel,l.payload))})}c.push([l,a])}),c}isInTransaction(){return o(this,Le)}async syncToFs(){if(o(this,Ge))return;y(this,Ge,!0);let t=async()=>{await o(this,Yt).runExclusive(async()=>{y(this,Ge,!1),await this.fs.syncToFs(o(this,ze))})};o(this,ze)?t():await t()}async listen(t,n){return o(this,j).has(t)||o(this,j).set(t,new Set),o(this,j).get(t).add(n),await this.exec(`LISTEN "${t}"`),async()=>{await this.unlisten(t,n)}}async unlisten(t,n){n?(o(this,j).get(t)?.delete(n),o(this,j).get(t)?.size===0&&(await this.exec(`UNLISTEN "${t}"`),o(this,j).delete(t))):(await this.exec(`UNLISTEN "${t}"`),o(this,j).delete(t))}onNotification(t){return o(this,Te).add(t),()=>{o(this,Te).delete(t)}}offNotification(t){o(this,Te).delete(t)}async dumpDataDir(t){let n=this.dataDir?.split("/").pop()??"pgdata";return this.fs.dumpTar(n,t)}_runExclusiveQuery(t){return o(this,Qt).runExclusive(t)}_runExclusiveTransaction(t){return o(this,$t).runExclusive(t)}};Ce=new WeakMap,xe=new WeakMap,Pe=new WeakMap,Le=new WeakMap,ze=new WeakMap,Qt=new WeakMap,$t=new WeakMap,Yt=new WeakMap,Ge=new WeakMap,At=new WeakMap,Tt=new WeakMap,Et=new WeakMap,Ae=new WeakMap,oe=new WeakMap,j=new WeakMap,Te=new WeakMap,Z=new WeakSet,ci=async function(t){if(t.fs)this.fs=t.fs;else{let{dataDir:m,fsType:x}=Pn(t.dataDir);this.fs=await An(m,x)}let n={},s=[],i=[`PGDATA=${B}`,`PREFIX=${Ye}`,`PGUSER=${t.username??"postgres"}`,`PGDATABASE=${t.database??"template1"}`,"MODE=REACT","REPL=N",...this.debug?["-d",this.debug.toString()]:[]];t.wasmModule||ei();let a=t.fsBundle?t.fsBundle.arrayBuffer():ri(),c;a.then(m=>{c=m});let l={WASM_PREFIX:Ye,arguments:i,INITIAL_MEMORY:t.initialMemory,noExitRuntime:!0,...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},instantiateWasm:(m,x)=>(ti(m,t.wasmModule).then(({instance:T,module:Q})=>{x(T,Q)}),{}),getPreloadedPackage:(m,x)=>{if(m==="postgres.data"){if(c.byteLength!==x)throw new Error(`Invalid FS bundle size: ${c.byteLength} !== ${x}`);return c}throw new Error(`Unknown package: ${m}`)},preRun:[m=>{let x=m.FS.makedev(64,0),T={open:Q=>{},close:Q=>{},read:(Q,je,ce,le,$)=>{let qr=o(this,Ae);if(!qr)throw new Error("No /dev/blob File or Blob provided to read from");let Kt=new Uint8Array(qr);if($>=Kt.length)return 0;let Wr=Math.min(Kt.length-$,le);for(let Ft=0;Ft<Wr;Ft++)je[ce+Ft]=Kt[$+Ft];return Wr},write:(Q,je,ce,le,$)=>(o(this,oe)??y(this,oe,[]),o(this,oe).push(je.slice(ce,ce+le)),le),llseek:(Q,je,ce)=>{let le=o(this,Ae);if(!le)throw new Error("No /dev/blob File or Blob provided to llseek");let $=je;if(ce===1?$+=Q.position:ce===2&&($=new Uint8Array(le).length),$<0)throw new m.FS.ErrnoError(28);return $}};m.FS.registerDevice(x,T),m.FS.mkdev("/dev/blob",x)}]},{emscriptenOpts:d}=await this.fs.init(this,l);l=d;for(let[m,x]of Object.entries(o(this,At)))if(x instanceof URL)n[m]=Gr(x);else{let T=await x.setup(this,l);if(T.emscriptenOpts&&(l=T.emscriptenOpts),T.namespaceObj){let Q=this;Q[m]=T.namespaceObj}T.bundlePath&&(n[m]=Gr(T.bundlePath)),T.init&&s.push(T.init),T.close&&o(this,Tt).push(T.close)}if(l.pg_extensions=n,await a,this.mod=await Yr(l),await this.fs.initialSyncFs(),t.loadDataDir){if(this.mod.FS.analyzePath(B+"/PG_VERSION").exists)throw new Error("Database already exists, cannot load from tarball");u(this,Z,Pt).call(this,"pglite: loading data from tarball"),await yn(this.mod.FS,t.loadDataDir,B)}this.mod.FS.analyzePath(B+"/PG_VERSION").exists?u(this,Z,Pt).call(this,"pglite: found DB, resuming"):u(this,Z,Pt).call(this,"pglite: no db"),await oi(this.mod,(...m)=>u(this,Z,Pt).call(this,...m));let p=this.mod._pg_initdb();if(!p)throw new Error("INITDB failed to return value");if(p&1)throw new Error("INITDB failed");if(p&2){let m=t.username??"postgres",x=t.database??"template1";if(p&4){if(!(p&12))throw new Error("Invalid db/user combination")}else if(x!=="template1"&&m!=="postgres")throw new Error("INITDB created a new datadir, but an alternative db/user was requested")}await this.syncToFs(),y(this,Ce,!0),await this.exec("SET search_path TO public;"),await this._initArrayTypes();for(let m of s)await m()},Pt=function(...t){this.debug>0&&console.log(...t)};var jr=Hr;f();0&&(module.exports={IdbFs,MemoryFS,Mutex,PGlite,formatQuery,messages,parse,protocol,types,uuid});
//# sourceMappingURL=index.cjs.map